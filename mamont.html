<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mamont AR</title>

  <script src="./libs/aframe.min.js"></script>
  <script src="./libs/aframe-extras.min.js"></script>
  <script src="./libs/mindar-image-aframe.prod.js"></script>

  <style>
    body { margin: 0; overflow: hidden; background: #000; }

    #scanning-overlay {
      position: absolute;
      bottom: 20px; left: 0; right: 0;
      text-align: center;
      color: white;
      z-index: 10;
      font-family: sans-serif;
      text-shadow: 0 0 5px black;
    }

    #guide-overlay {
      position: absolute;
      inset: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      opacity: 0.5;
      z-index: 5;
      pointer-events: none;
    }
  </style>

  <script>
    AFRAME.registerComponent('marker-handler', {
      init: function () {
        const guide = document.querySelector('#guide-overlay');
        const scanning = document.querySelector('#scanning-overlay');

        this.el.addEventListener('targetFound', () => {
          console.log("targetFound");
          guide.style.display = 'none';
          scanning.style.display = 'none';
        });

        this.el.addEventListener('targetLost', () => {
          console.log("targetLost");
          guide.style.display = 'block';
          scanning.style.display = 'block';
        });
      }
    });
  </script>
</head>

<body>
  <div id="scanning-overlay">Наведите на метку</div>
  <img id="guide-overlay" src="./mamont.jpg" />

  <a-scene
    mindar-image="imageTargetSrc: ./mamont.mind; autoStart: true; uiLoading: yes; uiScanning: no;"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false"
    renderer="colorManagement: true;"
  >
    <a-assets>
      <a-asset-item id="model" src="./mamont.glb"></a-asset-item>
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <a-entity mindar-image-target="targetIndex: 0" marker-handler>
      <a-gltf-model
        src="#model"
        position="0 0 0"
        scale="0.05 0.05 0.05"
        rotation="0 0 0"
        animation-mixer="clip: GltfAnimation 0; loop: repeat"
      ></a-gltf-model>
    </a-entity>
  </a-scene>

  <script>
    window.addEventListener("error", (e) => console.log("window.error:", e.message));
    window.addEventListener("unhandledrejection", (e) => console.log("promise:", e.reason));

    document.addEventListener("DOMContentLoaded", () => {
      const scene = document.querySelector("a-scene");
      scene.addEventListener("loaded", () => console.log("a-scene loaded"));
      scene.addEventListener("arReady", () => console.log("MindAR ready"));
      scene.addEventListener("arError", (e) => console.log("MindAR error", e.detail));
    });
  </script>
</body>
</html>
