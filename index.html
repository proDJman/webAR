<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebAR Video Fix</title>
    
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.0/dist/mindar-image-aframe.prod.js"></script>

    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
        
        /* Стартовый экран — критически важен для Android */
        #start-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 2000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: white; text-align: center;
        }
        #start-btn {
            padding: 20px 40px; font-size: 20px; cursor: pointer;
            background: #2196F3; border: none; border-radius: 10px; color: white;
        }

        #ar-video {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; z-index: 999; display: none;
        }

        #guide-overlay {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); width: 70vw;
            opacity: 0.5; z-index: 5; pointer-events: none; display: none;
        }
    </style>

    <script>
        // Функция запуска
        function startAR() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('guide-overlay').style.display = 'block';
            
            // Запускаем сцену программно
            const sceneEl = document.querySelector('a-scene');
            sceneEl.setAttribute('mindar-image', 'autoStart: true');
            
            // "Прогреваем" видео, чтобы браузер разрешил его потом
            const video = document.querySelector('#ar-video');
            video.play(); 
            video.pause();
        }

        AFRAME.registerComponent('video-handler', {
            init: function () {
                const video = document.querySelector('#ar-video');
                const guide = document.querySelector('#guide-overlay');

                this.el.addEventListener('targetFound', () => {
                    guide.style.display = 'none';
                    video.style.display = 'block';
                    video.play();
                });
            }
        });
    </script>
</head>
<body>

    <div id="start-screen">
        <h2>WebAR Проект</h2>
        <p>Для работы требуется доступ к камере</p>
        <button id="start-btn" onclick="startAR()">ЗАПУСТИТЬ AR</button>
    </div>
    
    <video id="ar-video" src="./mamont.mp4" preload="auto" playsinline webkit-playsinline loop></video>

    <img id="guide-overlay" src="./targets.jpg">

    <a-scene 
        mindar-image="imageTargetSrc: ./targets.mind; autoStart: false; uiLoading: no; uiScanning: no;" 
        vr-mode-ui="enabled: false" 
        device-orientation-permission-ui="enabled: true">
        
        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <a-entity mindar-image-target="targetIndex: 0" video-handler></a-entity>
    </a-scene>

</body>
</html>